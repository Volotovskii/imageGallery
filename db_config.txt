
CREATE TABLE user (
  USER_ID INT NOT NULL AUTO_INCREMENT,
  login VARCHAR(100) NOT NULL UNIQUE,
  PASSWORD VARCHAR(255) NOT NULL,
  role VARCHAR(50) NULL DEFAULT 'user',
  PRIMARY KEY (USER_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE user_token (
  user_id INT UNSIGNED NOT NULL,
  token_hash VARCHAR(300) NOT NULL,
  token_hash_vk VARCHAR(1024) NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NULL,
  PRIMARY KEY (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;



CREATE TABLE images (
  id INT NOT NULL AUTO_INCREMENT,
  file_name VARCHAR(255) NOT NULL,
  unique_name VARCHAR(255) NULL UNIQUE,
  user_id INT,
  uploaded_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE comments (
  id INT NOT NULL AUTO_INCREMENT,
  image_id INT NOT NULL,
  author_id INT,
  author VARCHAR(255),
  text TEXT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  
  -- Определение внешнего ключа с ON DELETE CASCADE
  CONSTRAINT fk_comments_images -- Имя ограничения
  FOREIGN KEY (image_id)
  REFERENCES images(id)
  ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
